<div class="c_title"><a href="/Technology/20150907142638.html">博客PHP框架</a></div><p style="line-height: 2em; text-indent: 2em;"><span style="font-size: 14px;">这个博客总算是简单的上线了，用PHP编写的，以前没用过PHP做过开发，这是第一次尝试，很喜欢PHP这个语言，都不知道为什么，可能是喜欢开源的这一套东西吧，从这次开始，开始学PHP了，也不知道以后会不会用到，好了闲话少说，把值得记录的一些技术问题写下来吧，本博第一篇！</span></p><p style="line-height: 2em; text-indent: 2em;"><span style="font-size: 14px;">1、静态化博客内容。</span></p><p style="line-height: 2em; text-indent: 2em;"><span style="font-size: 14px;">这个博客的每一篇内容在显示的时候都是调取的静态页，这样做现在自己感觉有两个好处，一是这样读取的速度是比较快的，相对于从数据库中读取出来，免去了连接数据库，然后读取显示这样一个过程；二是静态化有利于搜索引擎收录页面（待考证）。在发布博客的时候把数据存储到数据库中，并且生成一个博客内容的静态页，包括标题和内容，调用时只需要把这块内容填充到博客详情页的模板中。生成的静态页按照当前时间命名，然后存储到/年/月/日/这样的文件夹下，之所以把文件夹这么分，而不是放到统一文件夹下，是担心静态页多了以后，遍历查找时浪费时间，当然就实际情况来说这个设计可能是多虑了，这里需要记录一个PHP建立多级文件夹，并且赋给读写权限的代码。</span></p><pre class="brush:php;toolbar:false">function&nbsp;mkdirs($dir){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;is_dir($dir)&nbsp;or&nbsp;(mkdirs(dirname($dir))&nbsp;and&nbsp;(mkdir($dir)&nbsp;and&nbsp;chmod($dir,&nbsp;0777)));
}</pre><p style="line-height: 2em; text-indent: 2em;"><span style="font-size: 14px;">有人用mkdir(filepath,0777,true); 这个方法新建多级文件夹，但是这样的文件夹新建之后的权限不是777而是755 ，因为mkdir()函数指定的目录权限只能小于等于系统设定的默认权限。linux默认的umask如果为0022, 所以mkdir(filepath,0777,true);得到目录的权限是0755（0777-0022），但是也不能为此修改linux的umask值，因小失大了，所以找了上边的方法，并自己改了改。</span></p><p><br/></p><p style="line-height: 2em; text-indent: 2em;"><span style="font-size: 14px;">2、列表伪静态化。</span></p><p style="line-height: 2em; text-indent: 2em;"><span style="font-size: 14px;">可以看到这个博客列表的链接都是以.html结尾的，其实这个用的是一个nginx的rewrite做的伪静态化，这样做也是处于对SEO的考虑。从数据库中读取出来，然后循环显示，不过在显示的时候把超连接写成了/目录/时间.html这样一个连接，然后用rewrite方法得到相应的静态页，nginx rewrite代码：</span></p><pre class="brush:php;toolbar:false">rewrite&nbsp;&quot;^/(.*)/([0-9]{4})([0-9]{2})([0-9]{2})([0-9]*).html$&quot;&nbsp;/Content.php?Clo=$1/$2/$3/$4/$5&nbsp;last;</pre><p style="line-height: 2em; text-indent: 2em;"><span style="font-size: 14px;">$1是目录名称，然后后边就是年月日的文件夹路径，最后是文件名，这样在Content.php中直接调用对应路径下的静态页就行了。</span></p><p><br/></p><p style="line-height: 2em; text-indent: 2em;"><span style="font-size: 14px;">需要记录的大概这些，还有一些经验和不足的地方。nginx的rewrite方法在少量规则的时候可以用，但是当规则比较多的时候，用起来可能就比较麻烦了，可能会出现相互影响的问题，还有就是在nginx配置文件中写很多判断会影响响应速度，当规则比较多时用自己写的的方法来做伪静态可能会比较好，有待尝试。博客还有需要改进的地方，一个是详情页的title值还没有设置，因为都是一个页面直接调取的静态页，没有连接数据库的过程，也没有得到title的方法，再考虑。二是还没有加评论功能，感觉这个功能前期比较鸡肋，等到后期需要的时候再加吧，好了博客1.0 版本就这样了，以后还会陆续改进。<br/></span></p>