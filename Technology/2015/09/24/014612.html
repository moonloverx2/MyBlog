<div class="c_title"><a href="/Technology/20150924014612.html">Linux自动备份MySql数据库</a></div><p style="text-indent: 2em; line-height: 2em;"><span style="font-size: 14px;">数据库备份对于网站平台来说很重要，数据就是金钱，有时候的误操作可能就会导致数据库中数据丢失，有一次我们项目组的一个开发人员错写了一个方法，导致平台中所有商品的全部删除了，幸亏大数据部门的人员对数据三天一备份，才没有造成大的损失，所以数据库备份很重要。但是我们又不想每天自己半夜爬起来对数据库进行备份，所以我们可以编写设置一些东西来进行自动备份。</span></p><p style="text-indent: 2em; line-height: 2em;"><span style="font-size: 14px;">不过我们现在负责数据库的人员都是自己半夜爬起来备份的，我问他们为什么，他们说自动备份的和手动备份的是有区别的，自动备份的会出现不能用的情况(sql server数据库)，对此我表示疑问但没有深究，有待考证。</span><br/></p><p style="text-indent: 2em; line-height: 2em;"><span style="font-size: 14px;">今天想说的是MySql数据库备份，我们想要的是每天自动备份，并且还要定期删除一些备份，不要在服务器上占用很大空间。首先我们先看MySql的备份命令。</span></p><pre class="brush:php;toolbar:false">mysqldump&nbsp;-u&nbsp;root&nbsp;-p&quot;asdasd&quot;&nbsp;-h127.0.0.1&nbsp;userinfo&nbsp;&gt;&nbsp;backup.sql;</pre><p style="line-height: 2em; text-indent: 2em;"><span style="font-size: 14px;"></span><span style="font-size: 14px;">root是用户名，asdasd是密码，userinfo是你想备份的数据库，然后backup.sql 是备份出来的文件。这样我们可以在Linux利用crontab命令周期性的执行一个备份脚本，脚本里我们还可以对备份文件进行打包压缩，并按照时间命名压缩包，然后删除backup.sql备份文件，并且定期删除删除以前的压缩包，下边看一下这个简单的备份脚本。</span><br/></p><pre class="brush:php;toolbar:false">#!/bin/bash
#Program:
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;备份数据库

#2015、09、16&nbsp;&nbsp;&nbsp;xjd


mysqldump&nbsp;-u&nbsp;root&nbsp;-p&quot;asdasd&quot;&nbsp;-h127.0.0.1&nbsp;userinfo&nbsp;&gt;&nbsp;backup.sql;
tar&nbsp;cvfz&nbsp;$(date&nbsp;+%Y%m%d).tar.gz&nbsp;backup.sql;
rm&nbsp;-rf&nbsp;backup.sql;
rm&nbsp;-rf&nbsp;$(date&nbsp;-d&nbsp;&quot;5&nbsp;days&nbsp;ago&quot;&nbsp;+%Y%m%d).tar.gz</pre><p style="line-height: 2em; text-indent: 2em;"><span style="font-size: 14px;"></span><span style="font-size: 14px;">首先是备份数据库出来一个backup.sql文件，然后用tar命令进行打包压缩，并按照时间命名，然后删除备份文件，最后删除五天前的备份，这只是一个简单例子，还可以根据自己的需求，进行修改添加功能。编写完脚本之后，我们还需要让脚本定期执行，我用的是crontab命令，crontab -e 进行编辑。</span><br/></p><pre class="brush:php;toolbar:false">0&nbsp;0&nbsp;&nbsp;*&nbsp;*&nbsp;*&nbsp;backup.sh&nbsp;&amp;&gt;&nbsp;/dev/null</pre><p style="text-indent: 2em; line-height: 2em;"><span style="font-size: 14px;"></span><span style="font-size: 14px;">保存之后，这backup.sh脚本就会一天执行一次，crontab命令不熟悉的自行谷歌百度，还有一点要注意，我们看到最后有一个&amp;&gt;/dev/null 这样一句，这句是为了防止出现“You have new mail in /var/spool/mail/root&nbsp;”这样的错误，如果没有后边那句，那么每执行一次，linux就想把执行的结果以邮件的形式告诉你，当然如果你需要知道每次运行的结果，你可以配置一下，然后把结果发送到你的邮箱。到这里基本上自动备份的问题我们就完成了。</span><br/></p>